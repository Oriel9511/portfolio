---
import ExperienceItem from "./ExperienceItem.astro";

const experienceItems = [
    {
        id: 'alsacia',
        date: { en: "April 2025 – Present", es: "Abril 2025 – Presente" },
        title: { en: "Backend Developer | Alsacia | On-site | Full-time", es: "Desarrollador Backend | Alsacia | Presencial | Tiempo completo" },
        description: {
            en: "",
            es: ""
        },
        link: "https://www.linkedin.com/company/alsacia",
    },
    {
        id: 'bizdirect',
        date: { en: "2022 – April 2025", es: "2022 – Abril 2025" },
        title: { en: "Full Stack Software Developer | Bizdirect Consulting Inc. | Remote | Full-time", es: "Desarrollador de Software Full Stack | Bizdirect Consulting Inc. | Remoto | Tiempo completo" },
        description: {
            en: "",
            es: ""
        },
        link: "https://bizdirectconsulting.com",
    },
    {
        id: 'isucorp',
        date: { en: "May 2024 – September 2024", es: "Mayo 2024 – Septiembre 2024" },
        title: { en: "Full Stack Software Developer | IsuCorp | Remote | Part-time", es: "Desarrollador de Software Full Stack | IsuCorp | Remoto | Medio tiempo" },
        description: {
            en: "",
            es: ""
        },
        link: "https://www.isucorp.ca",
    },
];
---

<ol {...Astro.props} class={`relative border-s border-gray-200 dark:border-gray-700 ml-3 ${Astro.props.class}`} id="experience-list">
    {experienceItems.map((item) => (
        <li class="mb-10 ms-4">
            <ExperienceItem
                date={item.date.en}
                title={item.title.en}
                description={item.description.en}
                link={item.link}
                data-date-en={item.date.en}
                data-date-es={item.date.es}
                data-title-en={item.title.en}
                data-title-es={item.title.es}
                data-description-en={item.description.en}
                data-description-es={item.description.es}
            />
        </li>
    ))}
</ol>

<script>
    import { currentLanguage } from '../../i18n/languageStore';

    function updateExperienceContent() {
        const lang = currentLanguage.get();
        const experienceList = document.getElementById('experience-list');
        if (!experienceList) return;

        const items = experienceList.querySelectorAll('li');
        items.forEach((item, index) => {
            const dateEl = item.querySelector('.experience-date');
            const titleEl = item.querySelector('.experience-title');
            const descEl = item.querySelector('.experience-description');

            if (dateEl) {
                const date = item.querySelector('.experience-item')?.getAttribute(`data-date-${lang}`);
                if (date) dateEl.textContent = date;
            }

            if (titleEl) {
                const title = item.querySelector('.experience-item')?.getAttribute(`data-title-${lang}`);
                if (title) titleEl.textContent = title;
            }

            if (descEl) {
                const desc = item.querySelector('.experience-item')?.getAttribute(`data-description-${lang}`);
                if (desc) descEl.innerHTML = desc.replace(/\n/g, '<br>');
            }
        });
    }

    // Update on language change
    currentLanguage.subscribe(updateExperienceContent);

    // Initial update
    document.addEventListener('DOMContentLoaded', updateExperienceContent);
</script>

